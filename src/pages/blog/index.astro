---
import { getCollection } from 'astro:content';
import BlogCard from '../../components/BlogCard.astro';
import Layout from '../../layouts/Layout.astro';

const entries = await getCollection('blog');
// Filter out drafts in production (show them in dev mode)
const filteredEntries = entries.filter((entry) => {
  // In dev mode, show all posts including drafts
  if (import.meta.env.DEV) return true;
  // In production, hide drafts
  return !entry.data.draft;
});
// Sort by date, newest first
const sortedEntries = filteredEntries.sort((a, b) => 
  b.data.date.getTime() - a.data.date.getTime()
);
---

<Layout>
  <main class="blog-container">
    <h1 class="page-title">Blog</h1>
    
    <div class="blog-grid">
      {sortedEntries.map((entry) => (
        <div class={`blog-card-wrapper ${entry.data.draft ? 'draft-card' : ''}`}>
          {entry.data.draft && (
            <span class="draft-badge">DRAFT</span>
          )}
          <BlogCard entry={entry} />
        </div>
      ))}
    </div>
  </main>
</Layout>

<style>
  .blog-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 4rem 2rem;
    min-height: 100vh;
  }

  .page-title {
    font-family: 'Inter', sans-serif;
    font-size: 3rem;
    font-weight: 700;
    color: #ffffff;
    margin: 0 0 3rem 0;
    letter-spacing: -0.02em;
  }

  .blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .blog-card-wrapper {
    position: relative;
  }

  .draft-card {
    opacity: 0.7;
  }

  .draft-badge {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    z-index: 10;
    font-family: ui-monospace, 'Cascadia Code', monospace;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: rgba(251, 191, 36, 0.1);
    border: 1px solid rgb(251, 191, 36);
    border-radius: 0.25rem;
    color: rgb(251, 191, 36);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    pointer-events: none;
    box-shadow: 0 0 8px rgba(251, 191, 36, 0.2);
  }

  @media (max-width: 768px) {
    .blog-container {
      padding: 2rem 1rem;
    }

    .page-title {
      font-size: 2rem;
    }

    .blog-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

